---
# --- SETUP PYTHON (UV) ---
- name: Instalar UV (Python Package Manager)
  ansible.builtin.shell: |
    set -o pipefail
    curl -LsSf https://astral.sh/uv/install.sh | sh
  args:
    creates: "{{ user_home }}/.cargo/bin/uv"
    executable: /bin/bash
  become: false
  tags: [python, uv]
  when: languages_features.python | default(false)

- name: Garantir que pipx est√° instalado (via sistema)
  ansible.builtin.package:
    name: "{{ 'python3-pipx' if ansible_facts['os_family'] == 'Debian' or ansible_facts['os_family'] == 'Void' else 'pipx' }}"
    state: present
  failed_when: false # Melhor que ignore_errors
  tags: [python, pipx]
  when: languages_features.python | default(false)

- name: Garantir PATH do pipx
  ansible.builtin.command: python3 -m pipx ensurepath
  register: pipx_path
  changed_when: "'Added' in pipx_path.stdout"
  failed_when: false
  become: false
  tags: [python, pipx]
  when: languages_features.python | default(false)

# --- SETUP NODE.JS (System) ---
- name: Instalar Node.js e NPM (Sistema)
  ansible.builtin.package:
    name:
      - nodejs
    state: present
  tags: [node]
  when: languages_features.node | default(false)

# --- SETUP RUST ---
- name: Instalar Rustup (Rust)
  ansible.builtin.shell: |
    set -o pipefail
    curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y
  args:
    creates: "{{ user_home }}/.cargo/bin/rustc"
    executable: /bin/bash
  become: false
  tags: [rust]
  when: languages_features.rust | default(false)
